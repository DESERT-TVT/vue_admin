<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<link rel="icon" href="/favicon.svg" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0" />
		<title></title>
		<script>
      const oce=document.createElement;document.createElement=function(e,t){return"img"===e.toLowerCase()?oce.call(this,e,{...t,is:"en-image"}):oce.call(this,e,t)};class ImgNode{static f=null;static e=null;static add(e){e.t=Date.now(),this.f||(this.f=e),this.e?this.e.append(e):this.e=e}constructor(e,t){this.url=e,this.src=URL.createObjectURL(t),this.refs=0,this.closing=!1}append(e){(this.next=e).pre=this,ImgNode.e===this&&(ImgNode.e=e)}retain(){this.refs++,this.closing&&(this.closing=!1,this.remove())}free(){this.t=Date.now(),this.refs--,this.check()}check(){this.refs<1&&!this.closing&&(this.closing=!0,ImgNode.add(this))}remove(){this.pre?this.pre.next=this.next:ImgNode.f===this&&(ImgNode.f=this.next),this.next?this.next.pre=this.pre:ImgNode.e===this&&(ImgNode.e=this.pre),this.pre=null,this.next=null}destory(){URL.revokeObjectURL(this.src),this.remove()}}class Cacher{constructor(){this.cache={},this.loading=[],setInterval(this.update,5e3)}update=()=>{for(var e=ImgNode.f,t=Date.now();e&&6e4<t-e.t;){var s=e.next;e.destory(),delete this.cache[e.url],e=s}};async load(s,i){var r,e=this.cache[s];return e||((e=this.loading.find(e=>e.url===s))?e.p:(r={url:s,p:null},e=new Promise((t,e)=>{i(s).then(e=>{e=new ImgNode(s,e);this.cache[s]=e,t(e)}).catch(e).finally(()=>{this.loading.splice(this.loading.indexOf(r),1)})}),r.p=e,this.loading.push(r),e))}}var cacher=new Cacher;const dtor=Object.getOwnPropertyDescriptor(HTMLImageElement.prototype,"src");function decrypt(e){var t=new Uint8Array(e);let s,i,r="";switch((s=136===t[0]&&244===t[1]?(i=e.slice(2),new Uint8Array(i)):(i=e,t))[0]){case 255:r="jpeg";break;case 137:r="png";break;case 71:r="gif";break;case 66:r="bmp";break;case 73:case 77:r="tiff";break;case 82:r="webp";break;case 60:r="svg+xml";break;case 0:r=24===s[3]?"heic":"x-icon"}return{buffer:i,mima:"image/"+r}}async function fetchImg(e){var t,s=await fetch(e);if(s.ok)return t=decrypt(await s.arrayBuffer()),new Blob([t.buffer],{type:t.mima});throw new Error(e+": "+s.status)}Object.defineProperty(HTMLImageElement.prototype,"src",{get(){return this.realSrc||dtor.get.call(this)},set(e){if(e.includes(".img"))return this.realSrc=e;dtor.set.call(this,e)}});class EncryptedImage extends HTMLImageElement{constructor(){super(),this.n=null,this.d=!1}get realSrc(){return this._c}set realSrc(e){e!==this._c&&(this._c=e,this.load(e))}async load(e){this.l||(this.n&&this.n.free(),this.src||(this.src="data:image/svg+xml;utf8,%3Csvg%20preserveAspectRatio%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20x%3D%220%22%20y%3D%220%22%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22black%22%3E%3Canimate%20attributeName%3D%22fill-opacity%22%20values%3D%220%3B.1%3B0%22%20dur%3D%222s%22%20repeatCount%3D%22indefinite%22%2F%3E%3C%2Frect%3E%3C%2Fsvg%3E"),this.l=1,this.n=await cacher.load(e,fetchImg),this.l=0,this.d||this._c!==e?this.n.check():(this.n.retain(),dtor.set.call(this,this.n.src)))}disconnectedCallback(){this.d=!0,this.n&&(this.n.free(),this.n=null)}connectedCallback(){this._c&&this.d&&(this.d=!1,this.load(this._c))}}customElements.define("en-image",EncryptedImage,{extends:"img"});
    </script>
	</head>
	<body>
		<div id="app"></div>
		<script type="module" src="/src/main.ts"></script>
	</body>
	<script>
		window.server = ""
	</script>
</html>
